export type CommandMeta = {
  slug: string;
  title: string;
  description?: string;
  shortDescription?: string; // Backwards compatibility
  websitePath?: string; // related website page
  category?: string;
  longDescription?: string;
  example?: string;
  steps?: string[];
  ctaText?: string;
  ctaLink?: string;
  permissions?: string[];
  tags?: string[];
  screenshots?: string[];
};

export const commands: CommandMeta[] = [
  { 
    slug: 'create_meeting', 
    title: 'Create Meeting', 
    shortDescription: 'Create a new meeting link and share it with your team or leads.', 
    longDescription: 'Generate custom meeting links with automated scheduling, calendar integration, and follow-up sequences. Perfect for booking discovery calls and demos.',
    websitePath: '/features', 
    category: 'Collaboration',
    example: 'Create a 30-min discovery call link that automatically books into your calendar',
    steps: ['Set meeting duration and availability', 'Configure automated reminders', 'Share personalized booking link', 'Track booking analytics'],
    ctaText: 'Try Meeting Creator',
    ctaLink: '/demo',
    permissions: ['meeting_create', 'calendar_access'],
    tags: ['scheduling', 'automation', 'calendar']
  },
  { 
    slug: 'send_email', 
    title: 'Send Email', 
    shortDescription: 'Send personalized outreach emails directly from the platform.', 
    longDescription: 'Craft and send highly personalized emails with AI-powered subject lines, dynamic content insertion, and deliverability optimization.',
    websitePath: '/features', 
    category: 'Outreach',
    example: 'Send a personalized cold email to 50 prospects with 85% open rates',
    steps: ['Upload prospect list', 'Configure email template with variables', 'AI generates personalized content', 'Schedule and send with tracking'],
    ctaText: 'Start Email Campaign',
    ctaLink: '/demo',
    permissions: ['email_send', 'contact_access'],
    tags: ['email', 'outreach', 'personalization']
  },
  { 
    slug: 'find_leads', 
    title: 'Find Leads', 
    shortDescription: 'Search and qualify potential customers based on your target criteria.', 
    longDescription: 'Use AI-powered lead discovery to find high-quality prospects that match your ideal customer profile. Includes contact enrichment and qualification scoring.',
    websitePath: '/demo', 
    category: 'Lead Generation',
    example: 'Find 100 qualified SaaS companies with 10-50 employees in need of sales automation',
    steps: ['Define ideal customer profile', 'Set search parameters', 'AI searches multiple databases', 'Review and export qualified leads'],
    ctaText: 'Find My Leads',
    ctaLink: '/demo',
    permissions: ['lead_search', 'data_access'],
    tags: ['prospecting', 'ai', 'qualification']
  },
  { 
    slug: 'dashboard', 
    title: 'Business Dashboard', 
    shortDescription: 'Visualize live metrics like leads, revenue, CAC, and ROI.', 
    longDescription: 'Get real-time insights into your sales performance with customizable dashboards, automated reporting, and predictive analytics.',
    websitePath: '/analytics', 
    category: 'Analytics',
    example: 'Track pipeline health, conversion rates, and revenue forecasts in real-time',
    steps: ['Connect data sources', 'Customize dashboard widgets', 'Set up automated alerts', 'Share reports with team'],
    ctaText: 'View Analytics',
    ctaLink: '/analytics',
    permissions: ['analytics_view', 'dashboard_create'],
    tags: ['analytics', 'reporting', 'metrics']
  },
  { 
    slug: 'trends', 
    title: 'Trend Detection', 
    shortDescription: 'Discover rising topics and market shifts from public data sources.', 
    longDescription: 'Stay ahead of market trends with AI-powered analysis of social media, news, and industry data to identify emerging opportunities.',
    websitePath: '/trending-niches', 
    category: 'Market Intelligence',
    example: 'Discover that "AI automation for restaurants" is trending up 300% this month',
    steps: ['Set industry parameters', 'AI scans data sources', 'Analyze trend patterns', 'Get actionable insights'],
    ctaText: 'Explore Trends',
    ctaLink: '/trending-niches',
    permissions: ['market_research', 'trend_access'],
    tags: ['trends', 'market-research', 'opportunities']
  },
  { 
    slug: 'dripcampaign', 
    title: 'Drip Campaign', 
    shortDescription: 'Create personalized multi-step email/SMS campaigns.', 
    longDescription: 'Build sophisticated nurture sequences with conditional logic, A/B testing, and multi-channel touchpoints to convert leads into customers.',
    websitePath: '/features', 
    category: 'Nurture',
    example: 'Create a 7-touch email sequence that converts 23% of leads to meetings',
    steps: ['Design campaign flow', 'Create email/SMS templates', 'Set triggers and conditions', 'Launch and optimize'],
    ctaText: 'Build Campaign',
    ctaLink: '/features',
    permissions: ['campaign_create', 'email_send', 'sms_send'],
    tags: ['nurturing', 'automation', 'conversion']
  },
  { 
    slug: 'leadscore', 
    title: 'Lead Scoring', 
    shortDescription: 'Score leads based on fit and intent to prioritize outreach.', 
    longDescription: 'Automatically score and rank leads using AI analysis of firmographic data, behavioral signals, and engagement patterns.',
    websitePath: '/features', 
    category: 'Lead Management',
    example: 'Score 1000 leads and identify the top 50 most likely to buy this quarter',
    steps: ['Define scoring criteria', 'AI analyzes lead data', 'Generate priority scores', 'Focus on high-value prospects'],
    ctaText: 'Score My Leads',
    ctaLink: '/demo',
    permissions: ['lead_scoring', 'data_analysis'],
    tags: ['scoring', 'prioritization', 'qualification']
  },
  { 
    slug: 'pipeline', 
    title: 'Pipeline Management', 
    shortDescription: 'Review pipeline stages and progression with detailed analytics.', 
    longDescription: 'Manage your entire sales pipeline with stage tracking, deal progression analytics, and automated follow-up reminders.',
    websitePath: '/analytics', 
    category: 'CRM',
    example: 'Track 50 deals across 5 stages with automated progression alerts',
    steps: ['Configure pipeline stages', 'Add deals and contacts', 'Track progression', 'Analyze conversion rates'],
    ctaText: 'Manage Pipeline',
    ctaLink: '/analytics',
    permissions: ['pipeline_manage', 'deal_edit'],
    tags: ['pipeline', 'crm', 'sales-process']
  },
  { 
    slug: 'competitors', 
    title: 'Competitor Monitoring', 
    shortDescription: "Monitor competitors' pricing, offers, and campaigns in real-time.", 
    longDescription: 'Track competitor activities including pricing changes, new product launches, marketing campaigns, and customer feedback to stay competitive.',
    websitePath: '/features', 
    category: 'Market Intelligence',
    example: 'Monitor 5 competitors and get alerts when they change pricing or launch campaigns',
    steps: ['Add competitor websites', 'Set monitoring parameters', 'Receive automated alerts', 'Analyze competitive insights'],
    ctaText: 'Monitor Competitors',
    ctaLink: '/features',
    permissions: ['competitor_track', 'market_research'],
    tags: ['competitive-intelligence', 'monitoring', 'alerts']
  },
  { 
    slug: 'hotleads', 
    title: 'Hot Leads', 
    shortDescription: 'Identify and prioritize the most engaged prospects for immediate follow-up.', 
    longDescription: 'AI analyzes engagement patterns, website behavior, and interaction history to surface leads ready to buy right now.',
    websitePath: '/features', 
    category: 'Lead Management',
    example: 'Get daily list of 10 hot leads with 70% higher conversion probability',
    steps: ['AI analyzes engagement data', 'Calculates buying signals', 'Ranks leads by urgency', 'Provides follow-up recommendations'],
    ctaText: 'Find Hot Leads',
    ctaLink: '/demo',
    permissions: ['lead_analysis', 'engagement_tracking'],
    tags: ['hot-leads', 'engagement', 'urgency']
  }
];

// Add remaining commands with basic structure for now
const additionalCommands: CommandMeta[] = [
  { slug: 'verifyemail', title: 'Verify Email', shortDescription: 'Validate work email addresses to improve deliverability.', websitePath: '/features', category: 'Data Quality', tags: ['email', 'validation'] },
  { slug: 'stop_bot', title: 'Stop Services', shortDescription: 'Safely stop ongoing automations or background tasks.', websitePath: '/support', category: 'Administration', tags: ['admin', 'control'] },
  { slug: 'start_bot', title: 'Start Bot', shortDescription: 'Start the Discord bot and background services.', websitePath: '/commands/start_bot', category: 'Administration', ctaText: 'Start Bot', tags: ['admin', 'control', 'bot'] },
  { slug: 'customerinsights', title: 'Customer Insights', shortDescription: 'Analyze reviews and forums to uncover unmet customer needs.', websitePath: '/case-studies', category: 'Market Intelligence', tags: ['insights', 'analysis'] },
  { slug: 'upsell', title: 'Upsell & Cross-sell', shortDescription: 'Recommend relevant offers to increase average deal size.', websitePath: '/pricing', category: 'Revenue Optimization', tags: ['upselling', 'revenue'] },
  { slug: 'findpartners', title: 'Find Partners', shortDescription: 'Identify referral and integration partners to expand reach.', websitePath: '/features', category: 'Partnerships', tags: ['partnerships', 'referrals'] },
  { slug: 'retentionoffer', title: 'Retention Offers', shortDescription: 'Trigger targeted offers to reduce churn and retain clients.', websitePath: '/features', category: 'Retention', tags: ['retention', 'churn'] },
  { slug: 'predictsales', title: 'Sales Prediction', shortDescription: 'Forecast sales for upcoming days to allocate resources wisely.', websitePath: '/features', category: 'Analytics', tags: ['forecasting', 'prediction'] },
  { slug: 'synthesize_speech', title: 'Text-to-Speech', shortDescription: 'Convert text to speech for voice content and demos.', websitePath: '/features', category: 'Productivity', tags: ['tts', 'voice'] },
  { slug: 'outreach', title: 'Outreach', shortDescription: 'Send initial outreach via email, text, or direct message.', websitePath: '/features', category: 'Outreach', tags: ['outreach', 'initial-contact'] },
  { slug: 'bulkoutreach', title: 'Bulk Outreach', shortDescription: 'Scale outreach to multiple leads with personalization.', websitePath: '/features', category: 'Outreach', tags: ['bulk', 'scale'] },
  { slug: 'followup', title: 'Follow-up', shortDescription: 'Automate timely follow-ups using proven templates.', websitePath: '/features', category: 'Outreach', tags: ['follow-up', 'automation'] },
  { slug: 'bulkfollowup', title: 'Bulk Follow-up', shortDescription: 'Send follow-ups to many contacts based on status.', websitePath: '/features', category: 'Outreach', tags: ['bulk', 'follow-up'] },
  { slug: 'bookcall', title: 'Book Call', shortDescription: 'Schedule calls with leads and sync to your calendar.', websitePath: '/features', category: 'Scheduling', tags: ['booking', 'calendar'] },
  { slug: 'listcommands', title: 'List Features', shortDescription: 'Browse all available features and workflows.', websitePath: '/commands', category: 'General', tags: ['features', 'directory'] },
  { slug: 'resume', title: 'Resume Automation', shortDescription: 'Resume a paused automation or workflow.', websitePath: '/support', category: 'Administration', tags: ['resume', 'automation'] },
  { slug: 'sendbookinglink', title: 'Send Booking Link', shortDescription: 'Share a booking link with a lead to schedule a call.', websitePath: '/features', category: 'Scheduling', tags: ['booking', 'sharing'] },
  { slug: 'reschedulecall', title: 'Reschedule Call', shortDescription: 'Adjust a previously scheduled call to a new time.', websitePath: '/features', category: 'Scheduling', tags: ['reschedule', 'calendar'] },
  { slug: 'status', title: 'Task Status', shortDescription: 'Check the status of running tasks and operations.', websitePath: '/task-runs', category: 'Operations', tags: ['status', 'monitoring'] },
  { slug: 'report', title: 'Reports', shortDescription: 'Generate daily/weekly performance reports.', websitePath: '/analytics', category: 'Analytics', tags: ['reports', 'performance'] },
  { slug: 'analytics', title: 'Analytics Overview', shortDescription: 'Dive into performance analytics and dashboards.', websitePath: '/analytics', category: 'Analytics', tags: ['analytics', 'overview'] },
  { slug: 'trendingniches', title: 'Trending Niches', shortDescription: 'Discover fast-growing niches to target.', websitePath: '/trending-niches', category: 'Market Intelligence', tags: ['niches', 'trends'] },
  { slug: 'potentialclients', title: 'Potential Clients', shortDescription: 'Identify likely buyers based on your ICP.', websitePath: '/demo', category: 'Lead Generation', tags: ['prospects', 'icp'] },
  { slug: 'setwebhook', title: 'Set Webhook', shortDescription: 'Connect external services via webhooks.', websitePath: '/support', category: 'Integrations', tags: ['webhooks', 'integration'] },
  { slug: 'connectsheet', title: 'Connect Sheet', shortDescription: 'Connect a Google Sheet for leads and reporting.', websitePath: '/demo', category: 'Integrations', tags: ['google-sheets', 'data'] },
  { slug: 'setscript', title: 'Set Script', shortDescription: 'Configure default outreach and follow-up scripts.', websitePath: '/features', category: 'Configuration', tags: ['scripts', 'templates'] },
  { slug: 'pause', title: 'Pause Automation', shortDescription: 'Pause an active automation safely.', websitePath: '/support', category: 'Administration', tags: ['pause', 'control'] },
  { slug: 'help', title: 'Help', shortDescription: 'Get help and documentation for all features.', websitePath: '/support', category: 'General', tags: ['help', 'documentation'] },
  { slug: 'sales_status', title: 'Sales Status', shortDescription: 'Overview of sales performance and progress.', websitePath: '/analytics', category: 'Analytics', tags: ['status', 'sales'] },
  { slug: 'start_sales_agent', title: 'Start Sales Agent', shortDescription: 'Start the automated sales workflows.', websitePath: '/demo', category: 'Automation', tags: ['start', 'automation'] },
  { slug: 'approve_action', title: 'Approve Action', shortDescription: 'Review and approve pending actions.', websitePath: '/task-runs', category: 'Operations', tags: ['approval', 'review'] },
];

// Auto-generated commands from Discord bot
export const autoGeneratedCommands: CommandMeta[] = [
  {
    slug: 'create-meeting',
    title: 'Create Meeting',
    description: 'Creates a new Jitsi meeting link.',
    longDescription: `Creates a new Jitsi meeting link.`,
    category: 'General',
    example: '/create_meeting',
    steps: [
      'Execute the /create_meeting command in Discord',
      'Review the generated results',
      'Take action based on the output',
    ],
    ctaText: 'Try Command in Discord',
    ctaLink: 'https://discord.gg/your-bot-invite',
    permissions: [
      'Discord Bot Access',
    ],
    tags: [
      'create meeting',
      'general',
    ],
  },
  {
    slug: 'send-email',
    title: 'Send Email',
    description: 'Sends a cold outreach email to the specified recipient.',
    longDescription: `Sends a cold outreach email to the specified recipient with automatically generated subject and body.
    Usage: /send_email <recipient_email>
    Example: /send_email test@example.com`,
    category: 'Communication',
    example: '/send_email test@example.com',
    steps: [
      'Execute the /send_email command in Discord',
      'Review the generated results',
      'Take action based on the output',
    ],
    ctaText: 'Try Command in Discord',
    ctaLink: 'https://discord.gg/your-bot-invite',
    permissions: [
      'Discord Bot Access',
    ],
    tags: [
      'send email',
      'communication',
    ],
  },
  {
    slug: 'find-leads',
    title: 'Find Leads',
    description: 'Searches for businesses based on specified criteria.',
    longDescription: `Searches for businesses based on specified criteria.
    Usage: /find_leads <number_of_businesses> <niche>
    Example: /find_leads 10 "pipeline niche`,
    category: 'Lead Management',
    example: '/find_leads 10 "pipeline niche',
    steps: [
      'Execute the /find_leads command in Discord',
      'Review the generated results',
      'Take action based on the output',
    ],
    ctaText: 'Try Command in Discord',
    ctaLink: 'https://discord.gg/your-bot-invite',
    permissions: [
      'Discord Bot Access',
    ],
    tags: [
      'find leads',
      'lead management',
    ],
  },
  {
    slug: 'verifyemail',
    title: 'Verifyemail',
    description: 'Verifies a work email address before outreach.',
    longDescription: `Verifies a work email address before outreach.
    Usage: /verifyemail <email_address>
    Example: /verifyemail example@company.com`,
    category: 'Communication',
    example: '/verifyemail example@company.com',
    steps: [
      'Execute the /verifyemail command in Discord',
      'Review the generated results',
      'Take action based on the output',
    ],
    ctaText: 'Try Command in Discord',
    ctaLink: 'https://discord.gg/your-bot-invite',
    permissions: [
      'Discord Bot Access',
    ],
    tags: [
      'verifyemail',
      'communication',
    ],
  },
  {
    slug: 'stop-bot',
    title: 'Stop Bot',
    description: 'Stops the Discord bot. (Owner Only)',
    longDescription: `Stops the Discord bot.`,
    category: 'System',
    example: '/stop_bot',
    steps: [
      'Execute the /stop_bot command in Discord',
      'Review the generated results',
      'Take action based on the output',
    ],
    ctaText: 'Try Command in Discord',
    ctaLink: 'https://discord.gg/your-bot-invite',
    permissions: [
      'Discord Bot Access',
    ],
    tags: [
      'stop bot',
      'system',
    ],
  },
  {
    slug: 'competitors',
    title: 'Competitors',
    description: 'Monitors competitors\' pricing, offers, and marketing campaigns.',
    longDescription: `Monitors competitors' pricing, offers, and marketing campaigns.`,
    category: 'General',
    example: '/competitors',
    steps: [
      'Execute the /competitors command in Discord',
      'Review the generated results',
      'Take action based on the output',
    ],
    ctaText: 'Try Command in Discord',
    ctaLink: 'https://discord.gg/your-bot-invite',
    permissions: [
      'Discord Bot Access',
    ],
    tags: [
      'competitors',
      'general',
    ],
  },
];

// Helper to normalize slugs so that underscores and hyphens are treated the same
function normalizeSlug(slug: string): string {
  return (slug || '').toLowerCase().replace(/_/g, '-');
}

export function getCommand(slug: string): CommandMeta | undefined {
  const target = normalizeSlug(slug);
  return allCommands.find(c => normalizeSlug(c.slug) === target);
}

export function getAllCategories(): string[] {
  const categories = new Set<string>();
  allCommands.forEach(cmd => {
    if (cmd.category) categories.add(cmd.category);
  });
  return Array.from(categories).sort();
}

export function getCommandsByCategory(category: string): CommandMeta[] {
  return allCommands.filter(cmd => cmd.category === category);
}

export function searchCommands(query: string): CommandMeta[] {
  if (!query.trim()) return allCommands;
  
  const lowerQuery = query.toLowerCase();
  return allCommands.filter(cmd => 
    cmd.title.toLowerCase().includes(lowerQuery) ||
    (cmd.shortDescription || cmd.description || '').toLowerCase().includes(lowerQuery) ||
    cmd.longDescription?.toLowerCase().includes(lowerQuery) ||
    cmd.category?.toLowerCase().includes(lowerQuery) ||
    cmd.tags?.some(tag => tag.toLowerCase().includes(lowerQuery))
  );
}

export const allCommands = (() => {
  const combined = [...commands, ...additionalCommands, ...autoGeneratedCommands];
  // Deduplicate by normalized slug, keeping the first occurrence
  const map = new Map<string, CommandMeta>();
  for (const cmd of combined) {
    const key = normalizeSlug(cmd.slug);
    if (!map.has(key)) {
      map.set(key, cmd);
    }
  }
  return Array.from(map.values());
})();
